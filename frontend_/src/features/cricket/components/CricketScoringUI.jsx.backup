import React, { useCallback, useEffect, useMemo, useState } from "react";
import cricketAPIService from "../../../services/cricketAPI";

import { Card, CardContent, CardHeader, CardTitle } from "../../../components/ui/card";
import { Button } from "../../../components/ui/button";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "../../../components/ui/tabs";
import { Badge } from "../../../components/ui/badge";
import { Input } from "../../../components/ui/input";
import { Select, SelectTrigger, SelectValue, SelectContent, SelectItem } from "../../../components/ui/select";
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from "../../../components/ui/dialog";
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "../../../components/ui/table";
import { Separator } from "../../../components/ui/separator";
import { Popover, PopoverTrigger, PopoverContent } from "../../../components/ui/popover";
import { ScrollArea } from "../../../components/ui/scroll-area";
import { RotateCcw, Radio, AlertTriangle, Zap, TrendingUp, Activity } from "lucide-react";

// Utilities
const uid = () => Math.random().toString(36).slice(2, 9);

const formatOvers = (deliveries) => {
  const legal = deliveries.filter((d) => d.type !== "WIDE" && d.type !== "NOBALL").length;
  const overs = Math.floor(legal / 6);
  const balls = legal % 6;
  return `${overs}.${balls}`;
};

const calcRR = (runs, deliveries) => {
  const legal = deliveries.filter((d) => d.type !== "WIDE" && d.type !== "NOBALL").length;
  const overs = legal / 6;
  return overs === 0 ? 0 : parseFloat((runs / overs).toFixed(2));
};

const swapStrikeIfNeeded = (strikerId, nonStrikerId, runs, type) => {
  const isOdd = runs % 2 === 1;
  const isLegal = type !== "WIDE" && type !== "NOBALL";
  if (!isLegal) return { strikerId, nonStrikerId };
  if (isOdd) return { strikerId: nonStrikerId, nonStrikerId: strikerId };
  return { strikerId, nonStrikerId };
};

const endOfOverSwap = (strikerId, nonStrikerId, type, deliveries) => {
  const legalThisOver = deliveries.filter((d) => d.type !== "WIDE" && d.type !== "NOBALL").length % 6;
  if (legalThisOver === 0 && type !== "WIDE" && type !== "NOBALL") {
    return { strikerId: nonStrikerId, nonStrikerId: strikerId };
  }
  return { strikerId, nonStrikerId };
};

// Demo Seed Data
const demoPlayersA = [
  { id: uid(), name: "A. Shah (C)", role: "BAT" },
  { id: uid(), name: "R. Joshi", role: "BAT" },
  { id: uid(), name: "M. Patel", role: "BAT" },
  { id: uid(), name: "D. Kumar", role: "AR" },
  { id: uid(), name: "S. Iyer (WK)", role: "WK" },
  { id: uid(), name: "V. Rao", role: "AR" },
  { id: uid(), name: "H. Mehta", role: "BAT" },
  { id: uid(), name: "T. Singh", role: "BOWL" },
  { id: uid(), name: "P. Verma", role: "BOWL" },
  { id: uid(), name: "J. Parmar", role: "BOWL" },
  { id: uid(), name: "K. Jain", role: "BOWL" },
];

const demoPlayersB = [
  { id: uid(), name: "Z. Khan (C)", role: "AR" },
  { id: uid(), name: "L. Desai", role: "BAT" },
  { id: uid(), name: "B. Rana", role: "BAT" },
  { id: uid(), name: "U. Makwana", role: "BAT" },
  { id: uid(), name: "Q. Singh (WK)", role: "WK" },
  { id: uid(), name: "C. Sharma", role: "AR" },
  { id: uid(), name: "N. Modi", role: "AR" },
  { id: uid(), name: "R. Chawla", role: "BOWL" },
  { id: uid(), name: "I. Trivedi", role: "BOWL" },
  { id: uid(), name: "Y. Shah", role: "BOWL" },
  { id: uid(), name: "G. Ghosh", role: "BOWL" },
];

const seedMatch = {
  id: uid(),
  title: "Spoural '25 ‚Äî Cricket League",
  venue: "LDCE Ground, Ahmedabad",
  startTimeISO: new Date().toISOString(),
  status: "LIVE",
  teams: [
    { name: "CE Titans", players: demoPlayersA },
    { name: "IT Falcons", players: demoPlayersB },
  ],
  toss: { winner: "CE Titans", elected: "BAT" },
  innings: [
    {
      battingTeam: "CE Titans",
      bowlingTeam: "IT Falcons",
      oversLimit: 20,
      deliveries: [],
      wickets: 0,
      total: 0,
      strikerId: demoPlayersA[0].id,
      nonStrikerId: demoPlayersA[1].id,
      bowlerId: demoPlayersB[10].id,
      oversBowled: 0,
    },
  ],
  currentInningsIndex: 0,
};

// Subcomponents
function TeamStrip({ name, score, wickets, overs, right, muted = false }) {
  return (
    <div className={`flex items-center ${right ? "justify-end" : "justify-start"} gap-4 animate-fade-in`}>
      {!right && <div className="text-xl font-bold text-transparent truncate md:text-2xl bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text">{name}</div>}
      <div className={`px-6 py-3 rounded-3xl shadow-xl border-2 backdrop-blur-sm transition-all duration-300 hover:scale-105 ${muted ? "bg-gray-100/50 text-gray-400 border-gray-300" : "bg-gradient-to-br from-white to-blue-50 text-gray-900 border-blue-500 shadow-blue-200"}`}>
        <div className="text-3xl font-extrabold text-transparent tabular-nums bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text">{score}/{wickets}</div>
        <div className={`text-xs font-semibold ${muted ? "text-gray-400" : "text-gray-600"}`}>{overs} overs</div>
      </div>
      {right && <div className="text-xl font-bold text-right text-transparent truncate md:text-2xl bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text">{name}</div>}
    </div>
  );
}

function ScoreStrip({ total, wickets, overs, rr }) {
  return (
    <Card className="overflow-hidden border-2 border-blue-500 shadow-2xl rounded-3xl bg-gradient-to-br from-blue-50 via-white to-purple-50 animate-slide-up">
      <CardContent className="py-6">
        <div className="flex items-center justify-between gap-6">
          <div className="relative">
            <div className="absolute inset-0 blur-2xl opacity-30 bg-gradient-to-r from-blue-500 to-purple-500"></div>
            <div className="relative text-5xl font-black text-transparent tabular-nums bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text animate-pulse-slow">{total}/{wickets}</div>
          </div>
          <div className="flex gap-8">
            <div className="text-center">
              <div className="text-xs font-semibold tracking-wider text-gray-500 uppercase">Overs</div>
              <div className="text-2xl font-bold text-gray-900">{overs}</div>
            </div>
            <div className="text-center">
              <div className="text-xs font-semibold tracking-wider text-gray-500 uppercase">Run Rate</div>
              <div className="text-2xl font-bold text-transparent bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text">{rr}</div>
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}

function OverProgress({ deliveries }) {
  const legal = deliveries.filter((d) => d.type !== "WIDE" && d.type !== "NOBALL");
  const ballsInCurrentOver = legal.length % 6;

  return (
    <Card className="overflow-hidden border-2 border-purple-500 shadow-2xl rounded-3xl bg-gradient-to-br from-purple-50 via-white to-blue-50 animate-slide-up">
      <CardHeader className="pb-3 bg-gradient-to-r from-purple-500 to-blue-500">
        <CardTitle className="flex items-center gap-2 text-white">
          <Activity className="w-5 h-5 animate-pulse" />
          Current Over
        </CardTitle>
      </CardHeader>
      <CardContent className="pt-5">
        <div className="flex flex-wrap gap-3">
          {Array.from({ length: 6 }).map((_, i) => {
            const d = legal.slice(-(ballsInCurrentOver || 6))[i];
            const isFilled = i < ballsInCurrentOver;
            const label = d ? (d.type === "WICKET" ? "W" : d.batsmanRuns) : "";
            const isWicket = d?.type === "WICKET";
            const isFour = d?.batsmanRuns === 4;
            const isSix = d?.batsmanRuns === 6;
            
            return (
              <div 
                key={i} 
                className={`relative w-14 h-14 rounded-2xl grid place-items-center text-lg font-black tabular-nums transition-all duration-500 transform hover:scale-110 ${
                  isFilled 
                    ? isWicket 
                      ? "bg-gradient-to-br from-red-500 to-pink-600 text-white shadow-lg shadow-red-300 animate-bounce-once" 
                      : isFour
                      ? "bg-gradient-to-br from-blue-500 to-cyan-600 text-white shadow-lg shadow-blue-300 animate-bounce-once"
                      : isSix
                      ? "bg-gradient-to-br from-purple-500 to-pink-600 text-white shadow-lg shadow-purple-300 animate-bounce-once"
                      : "bg-gradient-to-br from-gray-800 to-gray-900 text-white shadow-lg"
                    : "bg-gray-100 text-gray-300 border-2 border-dashed border-gray-300"
                }`}
                style={{
                  animationDelay: `${i * 100}ms`
                }}
              >
                {isFilled && (
                  <div className="absolute inset-0 bg-white rounded-2xl opacity-30 blur-sm animate-ping-slow"></div>
                )}
                <span className="relative z-10">{isFilled ? label : ""}</span>
              </div>
            );
          })}
        </div>
        <div className="flex items-center gap-2 px-4 py-2 mt-4 text-xs font-semibold text-purple-900 bg-purple-100 rounded-lg">
          <Zap className="w-4 h-4" />
          Legal balls only ‚Ä¢ Extras don't count
        </div>
      </CardContent>
    </Card>
  );
}

function BattingTable({ deliveries, players, strikerId, nonStrikerId }) {
  const stats = useMemo(() => {
    const map = new Map();
    players.forEach((p) => map.set(p.id, { runs: 0, balls: 0, fours: 0, sixes: 0, out: false }));
    deliveries.forEach((d) => {
      const stats = map.get(d.strikerId);
      if (stats) {
        if (d.type !== "WIDE" && d.type !== "NOBALL") {
          stats.balls += 1;
        }
        stats.runs += d.batsmanRuns;
        if (d.batsmanRuns === 4) stats.fours += 1;
        if (d.batsmanRuns === 6) stats.sixes += 1;
        if (d.type === "WICKET") stats.out = true;
      }
    });
    return map;
  }, [deliveries, players]);

  const renderRow = (p) => {
    const s = stats.get(p.id);
    if (!s) return null;
    const sr = s.balls ? ((s.runs / s.balls) * 100).toFixed(1) : "0.0";
    const isOnStrike = p.id === strikerId || p.id === nonStrikerId;
    return (
      <TableRow key={p.id} className={`transition-all duration-300 ${isOnStrike ? "bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-blue-500" : "hover:bg-gray-50"}`}>
        <TableCell className="font-bold text-gray-900">
          {p.name}
          {p.id === strikerId && <Badge className="ml-2 text-white bg-gradient-to-r from-green-500 to-emerald-600 animate-pulse-slow">‚óè STRIKE</Badge>}
          {p.id === nonStrikerId && <Badge className="ml-2 text-white bg-gray-500" variant="secondary">‚óè</Badge>}
        </TableCell>
        <TableCell className="text-xl font-black text-right text-transparent tabular-nums bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text">{s.runs}</TableCell>
        <TableCell className="font-semibold text-right text-gray-700 tabular-nums">{s.balls}</TableCell>
        <TableCell className="font-semibold text-right text-gray-700 tabular-nums">{s.fours}</TableCell>
        <TableCell className="font-semibold text-right text-gray-700 tabular-nums">{s.sixes}</TableCell>
        <TableCell className="font-semibold text-right text-gray-700 tabular-nums">{sr}</TableCell>
        <TableCell className="font-semibold text-right">{s.out ? <span className="text-red-600">Out</span> : <span className="text-green-600">Not out</span>}</TableCell>
      </TableRow>
    );
  };

  return (
    <div className="overflow-hidden border-2 border-blue-300 rounded-2xl">
      <Table>
        <TableHeader className="bg-gradient-to-r from-blue-500 to-purple-500">
          <TableRow className="hover:bg-transparent">
            <TableHead className="font-bold text-white">Batsman</TableHead>
            <TableHead className="font-bold text-right text-white">R</TableHead>
            <TableHead className="font-bold text-right text-white">B</TableHead>
            <TableHead className="font-bold text-right text-white">4s</TableHead>
            <TableHead className="font-bold text-right text-white">6s</TableHead>
            <TableHead className="font-bold text-right text-white">SR</TableHead>
            <TableHead className="font-bold text-right text-white">Status</TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          {players.slice(0, 11).map((p) => renderRow(p))}
        </TableBody>
      </Table>
    </div>
  );
}

function BowlingTable({ deliveries, players, currentBowlerId }) {
  const stats = useMemo(() => {
    const map = new Map();
    players.forEach((p) => map.set(p.id, { ov: 0, runs: 0, wkts: 0, maidens: 0, balls: 0, dots: 0 }));
    
    const groupedByOver = new Map();
    deliveries.forEach((d) => {
      const stats = map.get(d.bowlerId);
      if (!stats) return;
      stats.runs += d.runs;
      if (d.type !== "WIDE" && d.type !== "NOBALL") {
        stats.balls += 1;
      }
      if (d.type === "WICKET") stats.wkts += 1;
      if (d.batsmanRuns === 0 && d.type !== "WIDE" && d.type !== "NOBALL") stats.dots += 1;
      
      const list = groupedByOver.get(d.over) || [];
      list.push(d);
      groupedByOver.set(d.over, list);
    });
    groupedByOver.forEach((balls) => {
      const bowlerId = balls[0]?.bowlerId;
      if (!bowlerId) return;
      const s = map.get(bowlerId);
      if (!s) return;
      const legalRuns = balls.reduce((acc, d) => acc + (d.type === "WIDE" || d.type === "NOBALL" ? 0 : d.runs), 0);
      const isMaiden = legalRuns === 0;
      if (isMaiden) s.maidens += 1;
    });
    players.forEach((p) => {
      const s = map.get(p.id);
      if (!s) return;
      s.ov = Math.floor(s.balls / 6) + (s.balls % 6) / 10;
    });
    return map;
  }, [deliveries, players]);

  const renderRow = (p) => {
    const s = stats.get(p.id);
    if (!s) return null;
    const eco = s.balls ? (s.runs / (s.balls / 6)).toFixed(2) : "0.00";
    const isCurrent = p.id === currentBowlerId;
    return (
      <TableRow key={p.id} className={`transition-all duration-300 ${isCurrent ? "bg-gradient-to-r from-orange-50 to-red-50 border-l-4 border-orange-500" : "hover:bg-gray-50"}`}>
        <TableCell className="font-bold text-gray-900">
          {p.name} {isCurrent && <Badge className="ml-2 text-white bg-gradient-to-r from-orange-500 to-red-600 animate-pulse-slow">BOWLING</Badge>}
        </TableCell>
        <TableCell className="font-semibold text-right text-gray-700 tabular-nums">{s.ov.toFixed(1)}</TableCell>
        <TableCell className="font-semibold text-right text-gray-700 tabular-nums">{s.maidens}</TableCell>
        <TableCell className="text-xl font-black text-right text-transparent tabular-nums bg-gradient-to-r from-red-600 to-orange-600 bg-clip-text">{s.runs}</TableCell>
        <TableCell className="font-semibold text-right text-gray-700 tabular-nums">{s.wkts}</TableCell>
        <TableCell className="font-semibold text-right text-gray-700 tabular-nums">{eco}</TableCell>
        <TableCell className="font-semibold text-right text-gray-700 tabular-nums">{s.dots}</TableCell>
      </TableRow>
    );
  };

  return (
    <div className="overflow-hidden border-2 border-orange-300 rounded-2xl">
      <Table>
        <TableHeader className="bg-gradient-to-r from-orange-500 to-red-500">
          <TableRow className="hover:bg-transparent">
            <TableHead className="font-bold text-white">Bowler</TableHead>
            <TableHead className="font-bold text-right text-white">O</TableHead>
            <TableHead className="font-bold text-right text-white">M</TableHead>
            <TableHead className="font-bold text-right text-white">R</TableHead>
            <TableHead className="font-bold text-right text-white">W</TableHead>
            <TableHead className="font-bold text-right text-white">Econ</TableHead>
            <TableHead className="font-bold text-right text-white">Dots</TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          {players.slice(0, 11).map((p) => renderRow(p))}
        </TableBody>
      </Table>
    </div>
  );
}

const Commentary = ({ deliveries, players }) => {
  const name = (id) => players.find((p) => p.id === id)?.name || "‚Äî";
  const items = [...deliveries].reverse();

  return (
    <ScrollArea className="pr-2 h-72">
      <ul className="grid gap-3">
        {items.map((d, idx) => {
          const isWicket = d.type === "WICKET";
          const isFour = d.batsmanRuns === 4;
          const isSix = d.batsmanRuns === 6;
          
          return (
            <li 
              key={d.id} 
              className={`flex items-start gap-3 p-4 rounded-2xl transition-all duration-300 hover:scale-102 hover:shadow-lg border-2 ${
                isWicket ? "bg-gradient-to-r from-red-50 to-pink-50 border-red-300" :
                isFour ? "bg-gradient-to-r from-blue-50 to-cyan-50 border-blue-300" :
                isSix ? "bg-gradient-to-r from-purple-50 to-pink-50 border-purple-300" :
                "bg-white border-gray-200"
              }`}
              style={{
                animationDelay: `${idx * 50}ms`
              }}
            >
              <Badge 
                className={`rounded-xl font-bold px-3 py-1 ${
                  isWicket ? "bg-gradient-to-r from-red-500 to-pink-600" :
                  isFour ? "bg-gradient-to-r from-blue-500 to-cyan-600" :
                  isSix ? "bg-gradient-to-r from-purple-500 to-pink-600" :
                  "bg-gradient-to-r from-gray-700 to-gray-900"
                } text-white`}
              >
                {d.over}.{d.ball + 1}
              </Badge>
              <div className="flex-1">
                <div className="text-sm font-bold text-gray-900">
                  {name(d.strikerId)} vs {name(d.bowlerId)} 
                  {isWicket && <span className="ml-2 text-red-600 animate-pulse">‚ö° WICKET!</span>}
                  {isFour && <span className="ml-2 text-blue-600">üéØ FOUR!</span>}
                  {isSix && <span className="ml-2 text-purple-600">üöÄ SIX!</span>}
                  {!isWicket && !isFour && !isSix && <span className="ml-2 text-gray-600">‚Äî {d.runs} run(s)</span>}
                </div>
                {d.notes && <div className="mt-1 text-xs italic text-gray-600">{d.notes}</div>}
              </div>
            </li>
          );
        })}
      </ul>
    </ScrollArea>
  );
};

const LineupCard = ({ title, players }) => {
  return (
    <Card className="overflow-hidden border-2 border-blue-500 shadow-xl rounded-2xl bg-gradient-to-br from-white to-blue-50">
      <CardHeader className="pb-3 bg-gradient-to-r from-blue-500 to-purple-500">
        <CardTitle className="text-lg font-bold text-white">{title}</CardTitle>
      </CardHeader>
      <CardContent className="pt-4">
        <ul className="grid gap-2 text-sm">
          {players.slice(0, 11).map((p, idx) => (
            <li 
              key={p.id} 
              className="flex items-center justify-between p-3 text-gray-900 transition-all duration-300 border-2 border-transparent rounded-xl hover:border-blue-500 hover:bg-blue-50 hover:scale-102 hover:shadow-md"
            >
              <span className="flex items-center gap-3">
                <span className="flex items-center justify-center w-8 h-8 text-xs font-black text-white rounded-full shadow-lg bg-gradient-to-br from-blue-500 to-purple-600">{idx + 1}</span>
                <span className="font-bold">{p.name}</span>
              </span>
              <Badge className="text-xs font-bold text-white bg-gradient-to-r from-gray-700 to-gray-900">{p.role}</Badge>
            </li>
          ))}
        </ul>
      </CardContent>
    </Card>
  );
};

const ScorerPanel = ({ 
  striker, 
  nonStriker, 
  bowler, 
  ballsInOver, 
  onScore, 
  onWicket, 
  onWide, 
  onNoBall, 
  onBye, 
  onLegBye, 
  onChangeStriker, 
  onChangeBowler, 
  bowlingOptions 
}) => {
  const [note, setNote] = useState("");
  const [wicketOpen, setWicketOpen] = useState(false);
  const [dismissalNote, setDismissalNote] = useState("");
  const [selectedBowler, setSelectedBowler] = useState(undefined);
  const [byesOpen, setByesOpen] = useState(false);
  const [legByesOpen, setLegByesOpen] = useState(false);

  useEffect(() => {
    if (selectedBowler) onChangeBowler(selectedBowler);
  }, [selectedBowler, onChangeBowler]);

  return (
    <Card className="sticky overflow-hidden border-2 border-purple-500 shadow-2xl rounded-3xl top-24 bg-gradient-to-br from-white via-purple-50 to-blue-50 animate-slide-up">
      <CardHeader className="pb-4 bg-gradient-to-r from-purple-600 to-blue-600">
        <CardTitle className="flex items-center gap-2 text-xl text-white">
          <div className="w-3 h-3 bg-white rounded-full shadow-lg animate-ping"></div>
          <div className="w-3 h-3 -ml-3 bg-white rounded-full"></div>
          Live Scoring
        </CardTitle>
      </CardHeader>
      <CardContent className="pt-6 space-y-5">
        {/* Current Players Info */}
        <div className="p-5 space-y-3 border-2 border-purple-300 shadow-xl rounded-2xl bg-gradient-to-br from-purple-50 to-blue-50">
          <div className="flex items-center justify-between">
            <span className="text-xs font-black tracking-wider text-purple-900 uppercase">‚ö° Striker</span>
            <Badge className="px-4 py-1.5 text-sm font-bold text-white shadow-lg bg-gradient-to-r from-green-500 to-emerald-600 animate-pulse-slow">{striker}</Badge>
          </div>
          <div className="flex items-center justify-between">
            <span className="text-xs font-black tracking-wider text-purple-900 uppercase">Non-Striker</span>
            <Badge className="px-4 py-1.5 text-sm font-bold text-gray-700 bg-gray-200 shadow-md" variant="secondary">{nonStriker}</Badge>
          </div>
          <Separator className="bg-purple-300" />
          <div className="flex items-center justify-between gap-3">
            <span className="text-xs font-black tracking-wider text-purple-900 uppercase">üéØ Bowler</span>
            <Select onValueChange={(v) => setSelectedBowler(v)} value={selectedBowler}>
              <SelectTrigger className="w-[200px] h-10 text-sm font-bold border-2 border-purple-500">
                <SelectValue placeholder={bowler || "Select Bowler"} />
              </SelectTrigger>
              <SelectContent className="max-h-60">
                {bowlingOptions.map((p) => (
                  <SelectItem key={p.id} value={p.id} className="font-semibold">{p.name}</SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
          <div className="flex items-center justify-between pt-2">
            <span className="text-xs font-black tracking-wider text-purple-900 uppercase">This Over</span>
            <Badge className="px-4 py-1.5 text-base font-black text-purple-900 bg-white border-2 border-purple-500 shadow-md font-mono tabular-nums">
              {ballsInOver}/6
            </Badge>
          </div>
        </div>

        {/* Quick Runs Section */}
        <div className="space-y-3">
          <h4 className="flex items-center gap-2 px-1 text-xs font-black tracking-wider uppercase text-purple-900">
            <TrendingUp className="w-4 h-4" />
            Quick Score
          </h4>
          <div className="grid grid-cols-7 gap-1.5">
            {[0, 1, 2, 3, 4, 5, 6].map((r) => (
              <Button 
                key={r} 
                onClick={() => onScore(r, "LEGAL", note)} 
                className={`h-16 rounded-2xl font-black text-xl transition-all duration-300 hover:scale-110 hover:rotate-3 shadow-lg ${
                  r === 0 ? "bg-gradient-to-br from-gray-700 to-gray-900 text-white hover:shadow-gray-400" :
                  r === 4 ? "bg-gradient-to-br from-blue-500 to-cyan-600 text-white hover:shadow-blue-400" :
                  r === 6 ? "bg-gradient-to-br from-purple-500 to-pink-600 text-white hover:shadow-purple-400" :
                  "bg-gradient-to-br from-indigo-500 to-blue-600 text-white hover:shadow-indigo-400"
                }`}
              >
                {r}
              </Button>
            ))}
          </div>
        </div>

        {/* Extras Section */}
        <div className="space-y-3">
          <h4 className="px-1 text-xs font-black tracking-wider uppercase text-purple-900">Extras</h4>
          <div className="grid grid-cols-2 gap-2">
            <Button 
              variant="outline" 
              onClick={() => onWide(1)} 
              className="h-12 text-sm font-black transition-all duration-300 border-2 rounded-2xl hover:scale-105 bg-gradient-to-br from-yellow-400 to-orange-500 text-white border-yellow-500 hover:shadow-lg hover:shadow-yellow-300"
            >
              Wide
            </Button>
            <Button 
              variant="outline" 
              onClick={() => onNoBall(0)} 
              className="h-12 text-sm font-black transition-all duration-300 border-2 rounded-2xl hover:scale-105 bg-gradient-to-br from-orange-400 to-red-500 text-white border-orange-500 hover:shadow-lg hover:shadow-orange-300"
            >
              No Ball
            </Button>
            <Button 
              variant="outline" 
              onClick={() => setByesOpen(true)}
              className="h-12 text-sm font-black text-gray-900 transition-all duration-300 bg-white border-2 border-gray-700 rounded-2xl hover:scale-105 hover:bg-gray-900 hover:text-white hover:shadow-lg"
            >
              Byes
            </Button>
            <Button 
              variant="outline" 
              onClick={() => setLegByesOpen(true)}
              className="h-12 text-sm font-black text-gray-900 transition-all duration-300 bg-white border-2 border-gray-700 rounded-2xl hover:scale-105 hover:bg-gray-900 hover:text-white hover:shadow-lg"
            >
              Leg Byes
            </Button>
          </div>
        </div>